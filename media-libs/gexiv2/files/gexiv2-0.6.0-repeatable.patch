From e43ffed8f1fdee22c6c8ff82f43ee651ac22f1ee Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20Mor=C3=A1vek=20=5BXificurk=5D?= <petr@pada.cz>
Date: Sun, 19 May 2013 10:06:18 +0200
Subject: [PATCH] Method for checking if IPTC tag is repeatable.

---
 gexiv2/gexiv2-metadata-iptc.cpp  | 13 +++++++++++++
 gexiv2/gexiv2-metadata-private.h |  1 +
 gexiv2/gexiv2-metadata.cpp       |  9 +++++++++
 gexiv2/gexiv2-metadata.h         |  8 ++++++++
 4 files changed, 31 insertions(+)

diff --git a/gexiv2/gexiv2-metadata-iptc.cpp b/gexiv2/gexiv2-metadata-iptc.cpp
index 56dbe49..4a1d9ff 100644
--- a/gexiv2/gexiv2-metadata-iptc.cpp
+++ b/gexiv2/gexiv2-metadata-iptc.cpp
@@ -275,4 +275,17 @@ const gchar* gexiv2_metadata_get_iptc_tag_type (const gchar* tag) {
     return NULL;
 }
 
+gboolean gexiv2_metadata_is_iptc_tag_repeatable (const gchar* tag) {
+    g_return_val_if_fail(tag != NULL, NULL);
+    
+    try {
+        Exiv2::IptcKey key (tag);
+        return Exiv2::IptcDataSets::dataSetRepeatable(key.tag(), key.record());
+    } catch (Exiv2::Error& e) {
+        LOG_ERROR(e);
+    }
+    
+    return FALSE;
+}
+
 G_END_DECLS
diff --git a/gexiv2/gexiv2-metadata-private.h b/gexiv2/gexiv2-metadata-private.h
index 4b08c0b..ed94f5f 100644
--- a/gexiv2/gexiv2-metadata-private.h
+++ b/gexiv2/gexiv2-metadata-private.h
@@ -79,6 +79,7 @@ gboolean		gexiv2_metadata_set_iptc_tag_multiple	(GExiv2Metadata *self, const gch
 const gchar*	gexiv2_metadata_get_iptc_tag_label	(const gchar* tag);
 const gchar*	gexiv2_metadata_get_iptc_tag_description	(const gchar* tag);
 const gchar*	gexiv2_metadata_get_iptc_tag_type	(const gchar* tag);
+gboolean		gexiv2_metadata_is_iptc_tag_repeatable	(const gchar* tag);
 
 
 G_END_DECLS
diff --git a/gexiv2/gexiv2-metadata.cpp b/gexiv2/gexiv2-metadata.cpp
index 1a83bf0..b7d6a9a 100644
--- a/gexiv2/gexiv2-metadata.cpp
+++ b/gexiv2/gexiv2-metadata.cpp
@@ -911,4 +911,13 @@ const gchar* gexiv2_metadata_get_tag_type (const gchar *tag) {
     return NULL;
 }
 
+gboolean gexiv2_metadata_is_tag_repeatable (const gchar *tag) {
+    g_return_val_if_fail(tag != NULL, NULL);
+    
+    if (gexiv2_metadata_is_iptc_tag(tag))
+        return gexiv2_metadata_is_iptc_tag_repeatable(tag);
+    
+    return FALSE;
+}
+
 G_END_DECLS
diff --git a/gexiv2/gexiv2-metadata.h b/gexiv2/gexiv2-metadata.h
index 0e412f0..ebeb01c 100644
--- a/gexiv2/gexiv2-metadata.h
+++ b/gexiv2/gexiv2-metadata.h
@@ -223,6 +223,14 @@ const gchar*	gexiv2_metadata_get_tag_description	(const gchar *tag);
  */
 const gchar*	gexiv2_metadata_get_tag_type	(const gchar *tag);
 
+/**
+ * gexiv2_metadata_is_tag_repeatable:
+ * @tag: Name of the tag who's repatable abbility you want
+ *
+ * Returns: (transfer none) (allow-none): Is tag repeatable
+ */
+gboolean	gexiv2_metadata_is_tag_repeatable	(const gchar *tag);
+
 
 /**
  * EXIF functions
-- 
1.8.1.5

